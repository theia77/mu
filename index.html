<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>cmd.exe — Love Mixtape</title>
  <style>
    :root {
      --bg: #0b0905;
      --panel: #100e09;
      --fg: #ffbf69;
      --muted: #f1a94e;
      --caret: #ffb200;
      --accent: #ffe8b0;
      --accent-2: #ffa94d;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: var(--mono);
      transition: background 300ms ease-out;
    }
    .controls { max-width: 900px; margin: 8px auto 0; padding: 6px 10px; color: var(--accent); font-size: 12px; display: flex; align-items: center; gap: 16px; }
    .controls input[type="range"] { width: 120px; vertical-align: middle; }
    .window {
      max-width: 900px;
      margin: 16px auto 14px;
      border: 1px solid var(--accent-2);
      box-shadow: 0 0 10px var(--accent-2), 0 0 24px var(--accent-2);
      background: var(--panel);
      border-radius: 10px;
      overflow: hidden;
      transition: all 300ms ease-out;
    }
    .titlebar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: rgba(0,0,0,0.2);
      color: var(--accent);
      font-size: 12px;
      border-bottom: 1px solid var(--accent-2);
    }
    .titlebar .dots { display: flex; gap: 6px; margin-right: 8px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; }
    .dot.red { background: #ff6b6b; }
    .dot.yellow { background: #ffd166; }
    .dot.green { background: #06d6a0; }
    .screen {
      padding: 16px 18px 24px;
      min-height: 50vh;
      line-height: 1.55;
      font-size: 16px;
      white-space: pre-wrap;
      color: var(--fg);
      text-shadow: 0 0 8px var(--accent);
    }
    .prompt-line { color: var(--muted); }
    .kbd { background: var(--panel); color: var(--accent); padding: 2px 6px; border: 1px solid var(--muted); border-radius: 4px; }
    .cursor { display: inline-block; width: 10px; height: 18px; margin-left: 2px; background: var(--caret); vertical-align: baseline; animation: blink 1s steps(1, end) infinite; }
    @keyframes blink { 50% { opacity: 0; } }
    .spotify-wrap { margin: 18px 0; animation: fadeIn 600ms ease forwards; display: none; }
    #spotify-embed { border-radius: 12px; width: 100%; height: 352px; border: 1px solid var(--muted); }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    #themeToggle { position: fixed; right: 16px; bottom: 16px; width: 44px; height: 44px; border-radius: 50%; border: 1px solid var(--accent); background: var(--panel); color: var(--accent); cursor: pointer; z-index: 100; }
    .now-playing { position: fixed; left: 16px; bottom: 16px; padding: 8px 12px; border-radius: 8px; background: var(--panel); color: var(--accent); border: 1px solid var(--accent); font-size: 12px; z-index: 100; display: none;}
    #hearts { pointer-events: none; position: fixed; inset: 0; z-index: 101;}
    .heart-fx { position: absolute; font-size: 16px; color: var(--accent-2); animation: floatUp 1.2s ease-in forwards; }
    @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100px); opacity: 0; } }
    @media (max-width: 600px) {
      .window { margin: 8px; }
      .screen { padding: 12px; font-size: 14px; min-height: 70vh; }
      .controls { flex-direction: column; gap: 8px; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="controls">
    <label>Speed <input id="speedRange" type="range" min="0" max="40" value="24" /></label>
    <div id="theme-name">Theme: Amber</div>
  </div>
  <div class="window">
    <div class="titlebar">
      <div class="dots"><div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div></div>
      <div class="title">C:\Windows\System32\cmd.exe — Love Mixtape</div>
    </div>
    <div class="screen" id="screen"></div>
  </div>
  <div id="hearts"></div>
  <button id="themeToggle" aria-label="Toggle theme" title="Toggle theme">♥</button>
  <div id="nowPlaying" class="now-playing"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // ------------- App State & DOM Elements -------------
    const screen = document.getElementById('screen');
    const speedEl = document.getElementById('speedRange');
    const themeToggleBtn = document.getElementById('themeToggle');
    const themeNameEl = document.getElementById('theme-name');
    let dedicateTo = localStorage.getItem('dedicateTo') || "You";
    let audioCtx;
    const typing = { speed: 16, cmdSpeed: 26, linePause: 200 };

    // ------------- Themes -------------
    const THEMES = {
        amber: { name: 'Amber', vars: { '--bg': '#0b0905', '--panel': '#100e09', '--fg': '#ffbf69', '--muted': '#f1a94e', '--caret': '#ffb200', '--accent': '#ffe8b0', '--accent-2': '#ffa94d' } },
        candy: { name: 'Candy Hearts', vars: { '--bg': '#0b0b12', '--panel': '#0f0f19', '--fg': '#e9e7ff', '--muted': '#cfcdf2', '--caret': '#ff79c6', '--accent': '#ffd6e7', '--accent-2': '#ff79c6' } },
        violet: { name: 'Midnight Violet', vars: { '--bg': '#0d0c1d', '--panel': '#131229', '--fg': '#d9d7ff', '--muted': '#b8b5e6', '--caret': '#c084fc', '--accent': '#e9d5ff', '--accent-2': '#a855f7' } },
        blush: { name: 'First Blush', vars: { '--bg': '#1c1014', '--panel': '#24161a', '--fg': '#ffdde9', '--muted': '#ffc2d4', '--caret': '#ff8fab', '--accent': '#fff0f3', '--accent-2': '#f472b6' } },
        evergreen: { name: 'Evergreen', vars: { '--bg': '#0a110d', '--panel': '#101914', '--fg': '#d1fae5', '--muted': '#a7f3d0', '--caret': '#fcd34d', '--accent': '#fef3c7', '--accent-2': '#fbbf24' } },
        ocean: { name: 'Ocean Deep', vars: { '--bg': '#020917', '--panel': '#061021', '--fg': '#cffafe', '--muted': '#a5f3fc', '--caret': '#67e8f9', '--accent': '#ecfeff', '--accent-2': '#22d3ee' } }
    };
    const themeKeys = Object.keys(THEMES);
    let currentThemeIndex = Math.max(0, themeKeys.indexOf(localStorage.getItem('mixtapeTheme')));

    function applyTheme(key) {
        const theme = THEMES[key];
        if (!theme) return;
        Object.entries(theme.vars).forEach(([k, v]) => document.documentElement.style.setProperty(k, v));
        if (themeNameEl) themeNameEl.textContent = `Theme: ${theme.name}`;
        localStorage.setItem('mixtapeTheme', key);
    }
    
    // ------------- Audio & Effects -------------
    async function initAudio() {
        if (audioCtx) return;
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) { console.error("Audio context not supported"); }
    }
    function playSound(type = 'click') {
        if (!audioCtx) return;
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.connect(g);
        g.connect(audioCtx.destination);
        if (type === 'click') {
            o.type = 'triangle';
            o.frequency.setValueAtTime(1200, audioCtx.currentTime);
            g.gain.setValueAtTime(0.2, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.05);
        } else { // Chime
            o.type = 'sine';
            o.frequency.setValueAtTime(type, audioCtx.currentTime);
            g.gain.setValueAtTime(0.25, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.4);
        }
        o.start();
        o.stop(audioCtx.currentTime + 0.5);
    }
    
    // ------------- Terminal Helpers -------------
    const el = (tag, cls, text) => { const e = document.createElement(tag); if(cls) e.className=cls; if(text) e.textContent=text; return e; };
    const appendLine = (text = "", parent = screen) => parent.insertAdjacentText('beforeend', text + "\n");
    const appendHTML = (html, parent = screen) => parent.insertAdjacentHTML('beforeend', html);
    const pause = (ms) => new Promise(r => setTimeout(r, ms));
    const appendPrompt = (parent = screen) => {
        const p = el("div");
        p.append(el("span", "prompt-line", "C:\\Users\\Heart> "), el("span", "prompt-input"), el("span", "cursor"));
        parent.appendChild(p);
        return p;
    };
    const typeTextTo = (node, text, speed) => new Promise(res => {
        let i = 0;
        const s = () => { if (i < text.length) { node.textContent += text[i++]; playSound(); setTimeout(s, speed); } else res(); };
        s();
    });
    const slowOutput = async (text) => {
        for (const ln of String(text).split("\n")) {
            appendLine(ln);
            screen.scrollTop = screen.scrollHeight;
            await pause(typing.speed);
        }
    };
    const handleInput = (promptText) => new Promise(resolve => {
        const p = appendPrompt();
        p.querySelector('.prompt-input').textContent = promptText;
        const input = el("span");
        p.insertBefore(input, p.querySelector('.cursor'));
        let current = "";
        const onKey = (e) => {
            if (e.key === 'Enter') { window.removeEventListener('keydown', onKey); p.querySelector('.cursor')?.remove(); resolve(current.trim()); }
            else if (e.key === 'Backspace') { current = current.slice(0, -1); }
            else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) { current += e.key; }
            input.textContent = current;
            e.preventDefault();
        };
        window.addEventListener('keydown', onKey);
    });

    // ------------- Content & Script Definition -------------
    const ASCII_ROSE = '        ,----.        \n       _\\_  /--.      \n      ´´ \\ ` ´  `---. \n       ` ´    //´´´`´ \n        ´´   //        \n            //         \n           //          \n    \\_ _ _´´           ';
    const SECRET_MEMORIES = ["\nThe night we met under the stars.", "Our first coffee date.", "That time we laughed until we cried.", "Every quiet moment in between.\n"];
    const PLAYLIST = [{ title: "End of Beginning", artist: "Djo" }, { title: "Die With A Smile", artist: "Lady Gaga, Bruno Mars" }, { title: "Ordinary", artist: "Alex Warren" }, { title: "blue", artist: "yung kai" }, { title: "Belong Together", artist: "Mark Ambor" }, { title: "Until I Found You", artist: "Stephen Sanchez" }, { title: "Let Her Go", artist: "Passenger" }, { title: "Infinity", artist: "Jaymes Young" }, { title: "Young And Beautiful", artist: "Lana Del Rey" }, { title: "Summertime Sadness", artist: "Lana Del Rey" }, { title: "I Wanna Be Yours", artist: "Arctic Monkeys" }];

    const script = [
        { type: "line", text: "Microsoft Windows [Version 10.0.19045]" }, { type: "line", text: "(c) Microsoft Corporation. All rights reserved." }, { type: "blank" },
        { type: "prompt", text: "echo Compiling our story..." }, { type: "type", text: ASCII_ROSE }, { type: "blank" },
        { type: "input", prompt: "This mixtape is dedicated to: ", storeIn: "dedicateTo" },
        { type: "prompt", text: () => `echo Loading mixtape for ${dedicateTo}...` }, { type: "blank" },
        { type: "prompt", text: "dir /b playlist\\love\\" }, { type: "type", text: PLAYLIST.map((t, i) => `${String(i + 1).padStart(2, "0")} - ${t.title}.mp3`).join("\n") }, { type: "blank" },
        { type: "action", fn: revealSpotifyEmbed },
        { type: "type", text: () => `╔══════════════════════════════════════╗\n║  <3 Now playing for ${dedicateTo}  <3  ║\n╚══════════════════════════════════════╝` },
        ...playbackBlocks(PLAYLIST), { type: "blank" },
        { type: "prompt", text: "echo Playlist complete. My love for you is not." }, { type: "type", text: "Forever and always... <3" }, { type: "blank" },
        { type: "action", fn: () => { setNowPlaying(null); playSound(523); } },
        { type: "line", text: "Type 'memories' for a surprise, or 'exit' to close." },
        { type: "command_prompt" }
    ];
    function playbackBlocks(list) {
        return list.flatMap((t, idx) => ([
            { type: "prompt", text: `play "${t.title}.mp3"` },
            { type: "action", fn: () => setNowPlaying(t.title) },
            { type: "type", text: `[TRACK ${String(idx + 1).padStart(2,"0")}] ${t.title} - ${t.artist}` }
        ]));
    }
    
    // ------------- Script Runner -------------
    async function run() {
        appendHTML(`<div class="note">C:\\&gt; REM CMD Love Mixtape — Press <span class="kbd">Enter</span> to skip typing</div>`);
        for (const item of script) {
            let text = typeof item.text === 'function' ? item.text() : item.text;
            if (item.type === "line") { appendLine(text); }
            else if (item.type === "blank") { appendLine(); }
            else if (item.type === "prompt") { const p = appendPrompt(); await typeTextTo(p.querySelector('.prompt-input'), text, typing.cmdSpeed); p.querySelector('.cursor')?.remove(); }
            else if (item.type === "type") { await slowOutput(text); }
            else if (item.type === "input") { const result = await handleInput(item.prompt); if (result) { dedicateTo = result; localStorage.setItem('dedicateTo', result); } }
            else if (item.type === "command_prompt") { await handleSecretCommands(); }
            else if (item.type === "action") { await item.fn(); }
            await pause(typing.linePause);
        }
    }

    async function handleSecretCommands() {
        while (true) {
            const cmd = await handleInput("");
            if (cmd.toLowerCase() === 'memories') {
                await slowOutput(`\nC:\\>type memories.txt${SECRET_MEMORIES.join('\n')}\n`);
            } else if (cmd.toLowerCase() === 'exit') {
                await slowOutput('Goodbye <3');
                return;
            } else if (cmd) {
                await slowOutput(`'${cmd}' is not recognized as a command.`);
            }
        }
    }

    // ------------- Event Listeners Setup -------------
    themeToggleBtn?.addEventListener('click', () => {
        currentThemeIndex = (currentThemeIndex + 1) % themeKeys.length;
        applyTheme(themeKeys[currentThemeIndex]);
    });
    speedEl?.addEventListener('input', () => {
        const val = parseInt(speedEl.value, 10);
        typing.speed = 40 - val;
        typing.cmdSpeed = 50 - val;
        localStorage.setItem('typingSpeed', val);
    });
    window.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            typing.speed = 0;
            typing.cmdSpeed = 0;
            setTimeout(() => {
                const val = parseInt(speedEl.value, 10);
                typing.speed = 40 - val;
                typing.cmdSpeed = 50 - val;
            }, 300);
        }
    }, { once: true });

    // ------------- Initialization -------------
    applyTheme(themeKeys[currentThemeIndex]);
    document.body.addEventListener('click', initAudio, { once: true });
    run();
});

// ------------- Global Helper Functions -------------
function revealSpotifyEmbed() {
    appendHTML(`<div class="spotify-wrap"><iframe id="spotify-embed" tabindex="0" src="https://open.spotify.com/embed/playlist/3Rx9zSZgNBRhkLMFkfO9Fz?utm_source=generator" loading="lazy" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe></div>`);
    const wrap = document.querySelector('.spotify-wrap');
    if (wrap) {
        wrap.style.display = 'block';
        playSound(740);
        burstHearts();
    }
}
function setNowPlaying(title) { const el = document.getElementById('nowPlaying'); if(el) { el.style.display = title ? 'block' : 'none'; el.textContent = title ? `Now Playing: ${title}`: ''; }}
function burstHearts(count = 18) { const c = document.getElementById('hearts'); if (!c) return; for (let i=0; i<count; i++) { const h = document.createElement('div'); h.className='heart-fx'; h.textContent='❤'; h.style.left = `${Math.random()*100}%`; h.style.animationDelay = `${Math.random()*0.4}s`; c.appendChild(h); setTimeout(()=>h.remove(), 1200);}}
</script>
</body>
</html>
