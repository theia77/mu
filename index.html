<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>cmd.exe — Love Mixtape</title>
  <style>
    /* Default to Amber theme; JS will load saved theme or default */
    :root {
      --bg: #0b0905;
      --panel: #100e09;
      --fg: #ffbf69;
      --muted: #f1a94e;
      --caret: #ffb200;
      --accent: #ffe8b0;
      --accent-2: #ffa94d;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: var(--mono);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: background 300ms ease-out;
    }
    .controls { max-width: 900px; margin: 8px auto 0; padding: 6px 10px; color: var(--accent); font-size: 12px; display: flex; align-items: center; gap: 16px; }
    .controls input[type="range"] { width: 120px; vertical-align: middle; }

    .window {
      max-width: 900px;
      margin: 16px auto 14px;
      border: 1px solid var(--accent-2, #f00);
      box-shadow: 0 0 0 1px var(--accent-2, #f00) inset, 0 0 24px var(--accent-2, #f00);
      background: var(--panel);
      border-radius: 10px;
      overflow: hidden;
      transition: all 300ms ease-out;
    }
    .titlebar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: rgba(0,0,0,0.2);
      color: var(--accent);
      font-size: 12px;
      border-bottom: 1px solid var(--accent-2, #f00);
    }
    .titlebar .dots { display: flex; gap: 6px; margin-right: 8px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; }
    .dot.red { background: #ff6b6b; }
    .dot.yellow { background: #ffd166; }
    .dot.green { background: #06d6a0; }
    .title { user-select: none; }

    .screen {
      padding: 16px 18px 24px;
      min-height: 60vh;
      line-height: 1.55;
      font-size: 16px;
      white-space: pre-wrap;
      color: var(--fg);
      text-shadow: 0 0 8px var(--accent-2, #f00);
    }
    .prompt-line { color: var(--muted); }
    .kbd {
      background: var(--panel);
      color: var(--accent);
      padding: 2px 6px;
      border: 1px solid var(--muted);
      border-radius: 4px;
    }
    .cursor {
      display: inline-block;
      width: 10px;
      height: 18px;
      margin-left: 2px;
      background: var(--caret);
      vertical-align: baseline;
      animation: blink 1s steps(1, end) infinite;
    }
    @keyframes blink { 50% { opacity: 0; } }

    /* Player is now inside the screen */
    .spotify-wrap {
      margin: 18px 0;
      animation: fadeIn 600ms ease forwards;
    }
    #spotify-embed {
      border-radius: 12px;
      width: 100%;
      height: 352px;
      border: 1px solid var(--muted);
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    #themeToggle {
      position: fixed; right: 16px; bottom: 16px;
      width: 44px; height: 44px;
      border-radius: 50%;
      border: 1px solid var(--accent);
      background: var(--panel);
      color: var(--accent);
      cursor: pointer;
      z-index: 100;
    }
    .now-playing {
      position: fixed; left: 16px; bottom: 16px;
      padding: 8px 12px; border-radius: 8px;
      background: var(--panel);
      color: var(--accent);
      border: 1px solid var(--accent);
      font-size: 12px;
      z-index: 100;
    }
    #hearts { pointer-events: none; position: fixed; inset: 0; overflow: hidden; z-index: 101;}
    .heart-fx {
      position: absolute; font-size: 16px; color: var(--accent-2);
      animation: floatUp 1.2s ease-in forwards;
    }
    @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100px); opacity: 0; } }
    
    /* Mobile responsive styles */
    @media (max-width: 600px) {
      body { font-size: 14px; }
      .window { margin: 8px; }
      .screen { padding: 12px; font-size: 14px; min-height: 70vh; }
      .controls { flex-direction: column; gap: 8px; align-items: flex-start; }
      #themeToggle { bottom: 10px; right: 10px; width: 40px; height: 40px;}
      .now-playing { bottom: 10px; left: 10px; font-size: 11px; padding: 6px 10px;}
    }
  </style>
</head>
<body>
  <div class="controls">
    <label>Speed <input id="speedRange" type="range" min="0" max="40" value="24" /></label>
    <div id="theme-name">Theme: Amber</div>
  </div>

  <div class="window">
    <div class="titlebar">
      <div class="dots">
        <div class="dot red"></div>
        <div class="dot yellow"></div>
        <div class="dot green"></div>
      </div>
      <div class="title">C:\Windows\System32\cmd.exe — Love Mixtape</div>
    </div>
    <div class="screen" id="screen" aria-live="polite">
        <!-- Spotify player will be injected here by the script -->
    </div>
  </div>

  <div id="hearts"></div>
  <button id="themeToggle" aria-label="Toggle theme" title="Toggle theme">♥</button>
  <div id="nowPlaying" class="now-playing" style="display:none;">Now Playing: —</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // ------------- App State & DOM Elements -------------
    const screen = document.getElementById('screen');
    const speedEl = document.getElementById('speedRange');
    const themeToggleBtn = document.getElementById('themeToggle');
    const themeNameEl = document.getElementById('theme-name');
    let dedicateTo = localStorage.getItem('dedicateTo') || "You";
    let audioCtx, clickBuffer;

    const typing = {
        speed: 40 - (parseInt(localStorage.getItem('typingSpeed') || '24')),
        cmdSpeed: 50 - (parseInt(localStorage.getItem('typingSpeed') || '24')),
        linePause: 260
    };
    if (speedEl) speedEl.value = localStorage.getItem('typingSpeed') || '24';
    
    // ------------- Themes -------------
    const THEMES = {
        amber: { name: 'Amber', vars: { '--bg': '#0b0905', '--panel': '#100e09', '--fg': '#ffbf69', '--muted': '#f1a94e', '--caret': '#ffb200', '--accent': '#ffe8b0', '--accent-2': '#ffa94d' } },
        candy: { name: 'Candy Hearts', vars: { '--bg': '#0b0b12', '--panel': '#0f0f19', '--fg': '#e9e7ff', '--muted': '#cfcdf2', '--caret': '#ff79c6', '--accent': '#ffd6e7', '--accent-2': '#ff79c6' } },
        violet: { name: 'Midnight Violet', vars: { '--bg': '#0d0c1d', '--panel': '#131229', '--fg': '#d9d7ff', '--muted': '#b8b5e6', '--caret': '#c084fc', '--accent': '#e9d5ff', '--accent-2': '#a855f7' } },
        blush: { name: 'First Blush', vars: { '--bg': '#1c1014', '--panel': '#24161a', '--fg': '#ffdde9', '--muted': '#ffc2d4', '--caret': '#ff8fab', '--accent': '#fff0f3', '--accent-2': '#f472b6' } },
        evergreen: { name: 'Evergreen', vars: { '--bg': '#0a110d', '--panel': '#101914', '--fg': '#d1fae5', '--muted': '#a7f3d0', '--caret': '#fcd34d', '--accent': '#fef3c7', '--accent-2': '#fbbf24' } },
        ocean: { name: 'Ocean Deep', vars: { '--bg': '#020917', '--panel': '#061021', '--fg': '#cffafe', '--muted': '#a5f3fc', '--caret': '#67e8f9', '--accent': '#ecfeff', '--accent-2': '#22d3ee' } }
    };
    const themeKeys = Object.keys(THEMES);
    let currentThemeIndex = themeKeys.indexOf(localStorage.getItem('mixtapeTheme')) !== -1 ? themeKeys.indexOf(localStorage.getItem('mixtapeTheme')) : 0;

    function applyTheme(key) {
        const theme = THEMES[key];
        if (!theme) return;
        Object.entries(theme.vars).forEach(([k, v]) => document.documentElement.style.setProperty(k, v));
        if (themeNameEl) themeNameEl.textContent = `Theme: ${theme.name}`;
        localStorage.setItem('mixtapeTheme', key);
    }

    // ------------- Terminal & Display Helpers -------------
    const el = (tag, cls, text) => { const e = document.createElement(tag); if(cls) e.className=cls; if(text) e.textContent=text; return e; };
    const appendLine = (text = "", parent = screen) => { parent.appendChild(document.createTextNode(text + "\n")); };
    const appendHTML = (html, parent = screen) => { const d = el("div"); d.innerHTML = html; parent.appendChild(d); };
    const pause = (ms) => new Promise(r => setTimeout(r, ms));
    const appendPrompt = (parent = screen) => { const p = el("div"); p.append(el("span", "prompt-line", "C:\\Users\\Heart> "), el("span", "prompt-input"), el("span", "cursor")); parent.appendChild(p); return p; };
    const typeTextTo = (node, text) => new Promise(res => { let i = 0; const s = () => { if (i < text.length) { node.textContent += text[i++]; playClick(); setTimeout(s, typing.cmdSpeed); } else res(); }; s(); });
    const slowOutput = async (text, speed = typing.speed) => { for (const ln of String(text).split("\n")) { appendLine(ln); await pause(speed); } };
    
    // ------------- Interactive Features -------------
    const handleInput = (promptText) => new Promise(resolve => {
        const p = appendPrompt();
        p.querySelector('.prompt-input').textContent = promptText;
        const input = el("span");
        p.insertBefore(input, p.querySelector('.cursor'));
        let current = "";
        const onKey = (e) => {
            if (e.key === 'Enter') { window.removeEventListener('keydown', onKey); p.querySelector('.cursor')?.remove(); appendLine(""); resolve(current.trim()); }
            else if (e.key === 'Backspace') { current = current.slice(0, -1); }
            else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) { current += e.key; }
            input.textContent = current;
            e.preventDefault();
        };
        window.addEventListener('keydown', onKey);
    });

    // ------------- Content & Script -------------
    const ASCII_ROSE = '        ,----.        \n       _\\_  /--.      \n      ´´ \\ ` ´  `---. \n       ` ´    //´´´`´ \n        ´´   //        \n            //         \n           //          \n    \\_ _ _´´           ';
    const WHISPERS = ["this one reminds me of you...", "for all the moments, big and small.", "our song.", "thinking of your smile.", "just for you."];
    const SECRET_MEMORIES = ["The night we met under the stars.", "Our first coffee date.", "That time we laughed until we cried.", "Every quiet moment in between."];
    const PLAYLIST = [{ title: "End of Beginning", artist: "Djo" }, { title: "Die With A Smile", artist: "Lady Gaga, Bruno Mars" }, { title: "Ordinary", artist: "Alex Warren" }, { title: "blue", artist: "yung kai" }, { title: "Belong Together", artist: "Mark Ambor" }, { title: "Until I Found You (with Em Beihold)", artist: "Stephen Sanchez, Em Beihold" }, { title: "Let Her Go (feat. Ed Sheeran)", artist: "Passenger" }, { title: "Infinity", artist: "Jaymes Young" }, { title: "Young And Beautiful", artist: "Lana Del Rey" }, { title: "Summertime Sadness", artist: "Lana Del Rey" }, { title: "Diet Mountain Dew", artist: "Lana Del Rey" }, { title: "Lay All Your Love On Me", artist: "ABBA" }, { title: "Mr. Loverman", artist: "Ricky Montgomery" }, { title: "I Wanna Be Yours", artist: "Arctic Monkeys" }, { title: "The Night We Met", artist: "Lord Huron" }, { title: "Night Changes", artist: "One Direction" }, { title: "Dandelions", artist: "Ruth B." }, { title: "Until I Found You", artist: "Stephen Sanchez" }, { title: "That’s So True", artist: "Gracie Abrams" }, { title: "Heather", artist: "Conan Gray" }, { title: "Apocalypse", artist: "Cigarettes After Sex" }, { title: "Runaway", artist: "AURORA" }, { title: "golden hour", artist: "JVKE" }, { title: "I Love You So", artist: "The Walters" }, { title: "Line Without a Hook", artist: "Ricky Montgomery" }, { title: "i'm yours", artist: "Isabel LaRosa" }, { title: "Let Me Down Slowly", artist: "Alec Benjamin" }, { title: "we fell in love in october", artist: "girl in red" }, { title: "deja vu", artist: "Olivia Rodrigo" }, { title: "Yellow", artist: "Coldplay" }];

    const script = [
        { type: "line", text: "Microsoft Windows [Version 10.0.19045]" }, { type: "line", text: "(c) Microsoft Corporation. All rights reserved." }, { type: "blank" },
        { type: "prompt", text: "echo Compiling our story..." }, { type: "type", text: ASCII_ROSE, speed: 10 }, { type: "blank" },
        { type: "input", prompt: "This mixtape is dedicated to: ", storeIn: "dedicateTo" },
        { type: "prompt", text: () => `echo Loading mixtape for ${dedicateTo}...` }, { type: "blank" },
        { type: "prompt", text: "dir /b playlist\\love\\" }, { type: "type", text: PLAYLIST.map((t, i) => `${String(i + 1).padStart(2, "0")} - ${t.title}.mp3`).join("\n") }, { type: "blank" },
        { type: "action", fn: () => { playChime(740, 0.1); revealSpotifyEmbed(); } },
        { type: "type", text: () => `╔══════════════════════════════════════╗\n║  <3 Now playing for ${dedicateTo}  <3  ║\n╚══════════════════════════════════════╝` },
        ...playbackBlocks(PLAYLIST), { type: "blank" },
        { type: "prompt", text: "echo Playlist complete. My love for you is not." }, { type: "type", text: "Forever and always... <3" }, { type: "blank" },
        { type: "action", fn: () => { setNowPlaying(null); playChime(523, 0.16); } },
        { type: "command_prompt" }
    ];

    function playbackBlocks(list) {
        return list.flatMap((t, idx) => {
            const block = [
                { type: "prompt", text: `play "${t.title}.mp3"` },
                { type: "action", fn: () => setNowPlaying(t.title) },
                { type: "type", text: `[TRACK ${String(idx + 1).padStart(2,"0")}] ${t.title} - ${t.artist}` },
            ];
            if ((idx + 1) % 5 === 0) {
                block.push({ type: "type", text: `REM whisper: ${WHISPERS[Math.floor(Math.random() * WHISPERS.length)]}` });
            }
            block.push({ type: "blank" });
            return block;
        });
    }

    // ------------- Runner -------------
    async function run() {
        initAudio();
        screen.innerHTML = "";
        appendHTML(`<div class="note">C:\\&gt; REM CMD Love Mixtape — Press <span class="kbd">Enter</span> to skip typing</div>`, screen);
        appendLine("", screen);

        for (const item of script) {
            let text = typeof item.text === 'function' ? item.text() : item.text;
            if (item.type === "line") { appendLine(text); await pause(typing.linePause); }
            else if (item.type === "blank") { appendLine(""); await pause(typing.linePause / 2); }
            else if (item.type === "prompt") { const p = appendPrompt(); await typeTextTo(p.querySelector('.prompt-input'), text); p.querySelector('.cursor')?.remove(); appendLine(""); await pause(typing.linePause); }
            else if (item.type === "type") { await slowOutput(text, item.speed); }
            else if (item.type === "input") { const result = await handleInput(item.prompt); if (result) { window[item.storeIn] = result; dedicateTo = result; localStorage.setItem('dedicateTo', result); } }
            else if (item.type === "command_prompt") { await handleSecretCommands(); }
            else if (item.type === "action") { await item.fn(); }
        }
    }
    
    // ------------- Post-Script Interactivity -------------
    async function handleSecretCommands() {
        while(true) {
            const cmd = await handleInput("");
            if (cmd.toLowerCase() === 'memories') {
                await slowOutput(`\nC:\\>type memories.txt\n\n${SECRET_MEMORIES.join('\n')}\n`);
            } else if (cmd.toLowerCase() === 'exit') {
                await slowOutput('Goodbye <3');
                break;
            } else if (cmd) {
                await slowOutput(`'${cmd}' is not recognized as an internal or external command.`);
            }
        }
    }

    // ------------- Event Listeners -------------
    themeToggleBtn?.addEventListener('click', () => {
        currentThemeIndex = (currentThemeIndex + 1) % themeKeys.length;
        applyTheme(themeKeys[currentThemeIndex]);
    });
    speedEl?.addEventListener('input', () => {
        const val = parseInt(speedEl.value, 10);
        typing.speed = 40 - val;
        typing.cmdSpeed = 50 - val;
        localStorage.setItem('typingSpeed', val);
    });
    
    // ------------- Initialization -------------
    applyTheme(themeKeys[currentThemeIndex]);
    run();
});

// Helper functions for spotify embed and effects
function revealSpotifyEmbed() {
    const spotifyHTML = `
      <div id="spotify-embed-wrap" class="spotify-wrap" style="display:none;">
        <iframe id="spotify-embed" tabindex="0"
          src="https://open.spotify.com/embed/playlist/3Rx9zSZgNBRhkLMFkfO9Fz?utm_source=generator"
          width="100%" height="352" frameborder="0"
          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
          loading="lazy"></iframe>
      </div>`;
    document.getElementById('screen').insertAdjacentHTML('beforeend', spotifyHTML);
    const wrap = document.getElementById('spotify-embed-wrap');
    if (wrap) {
        wrap.style.display = 'block';
        setTimeout(() => document.getElementById('spotify-embed')?.focus(), 200);
    }
    burstHearts();
}
function setNowPlaying(title) { const el = document.getElementById('nowPlaying'); if (!el) return; el.style.display = title ? 'block' : 'none'; if(title) el.textContent = `Now Playing: ${title}`; }
function burstHearts(count = 18) { const c = document.getElementById('hearts'); if (!c) return; for (let i=0; i<count; i++) { const h = document.createElement('div'); h.className='heart-fx'; h.textContent='❤'; h.style.left = `${Math.random()*100}%`; h.style.animationDelay = `${Math.random()*0.4}s`; c.appendChild(h); setTimeout(()=>h.remove(), 1200);}}
</script>
</body>
</html>
